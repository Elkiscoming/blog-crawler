{% extends "crawl/base.html" %}

{% block title %}Blogs{% endblock title %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col s12 m6">
      <div class="card grey lighten-1">
        <div class="card-content">
          <span class="card-title">Number of Blogs</span>
          <p>{{ blogs_length }}</p>
        </div>
      </div>
    </div>
    <div class="col s12 m6">
      <div class="card grey lighten-1">
        <div class="card-content">
          <span class="card-title">Number of Links</span>
          <p>{{ links_length }}</p>
        </div>
      </div>
    </div>
  </div>
    <div class="row">
        <div class="col m12 s12">
            <h4>Sorted with in-degree</h4>
            <div id="dest-collection" class="collection">
            </div>
            <div id="dest-pagination">
            </div>
            <h4>Sorted with out-degree</h4>
            <div id="src-collection" class="collection">
            </div>
            <div id="src-pagination">
            </div>
            <h4>Sorted with coeffition</h4>
            <div id="coef-collection" class="collection">
            </div>
            <div id="coef-pagination">
            </div>
        </div>
    </div>
</div>
{% endblock content %}


{% block script %}
<script>

$(function(){
    for(var index = 0; index < 20 ; index++){
        $('#dest-collection').append('<div id="dest-collection-item-' + index + '"></div>');
        $('#src-collection').append('<div id="src-collection-item-' + index + '"></div>');
        $('#coef-collection').append('<div id="coef-collection-item-' + index + '"></div>');
    }
    $('#dest-pagination').materializePagination({
        align: 'center',
        lastPage:  {{ blog_page_count }},
        firstPage:  1,
        useUrlParameter: false,
        onClickCallback: function(requestedPage){
            $.get('/blog/in_degrees/' + requestedPage, function(data){
                list = JSON.parse(data);
                blogList = []
                for(var index in list){
                    $.get('/blog/api/blog/' + list[index] + '?get=json', function(blog){
                        blogList[this.index] = blog;
                        $('#dest-collection-item-' + this.index).html('<a href="/blog/blog/' + blog.name + '" class="collection-item">' +
                                blog.name + '<span class="badge">' + blog.dest.length + '</span></a>');

                    }.bind({index: index}));
                }
            });
        }
    });
    $('#src-pagination').materializePagination({
        align: 'center',
        lastPage:  {{ blog_page_count }},
        firstPage:  1,
        useUrlParameter: false,
        onClickCallback: function(requestedPage){
            $.get('/blog/out_degrees/' + requestedPage, function(data){
                list = JSON.parse(data);
                blogList = []
                for(var index in list){
                    $.get('/blog/api/blog/' + list[index] + '?get=json', function(blog){
                        blogList[this.index] = blog;
                        $('#src-collection-item-' + this.index).html('<a href="/blog/blog/' + blog.name + '" class="collection-item">' +
                                blog.name + '<span class="badge">' + blog.src.length + '</span></a>');

                    }.bind({index: index}));
                }
            });
        }
    });
    $('#coef-pagination').materializePagination({
        align: 'center',
        lastPage:  {{ blog_page_count }},
        firstPage:  1,
        useUrlParameter: false,
        onClickCallback: function(requestedPage){
            $.get('/blog/coef/' + requestedPage, function(data){
                list = JSON.parse(data);
                blogList = []
                for(var index in list){
                    $.get('/blog/api/blog/' + list[index] + '?get=json', function(blog){
                        blogList[this.index] = blog;
                        $('#coef-collection-item-' + this.index).html('<a href="/blog/blog/' + blog.name + '" class="collection-item">' +
                                blog.name + '<span class="badge">' + blog.coeffition + '</span></a>');

                    }.bind({index: index}));
                }
            });
        }
    });
});
</script>
{% endblock script %}